<!DOCTYPE html>
<!-- saved from url=(0076)https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./Technical Debt Page_DSAv2.x_files/getid.js.download"></script>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="IoT">
    
    <!-- Begin Jekyll SEO tag v2.2.3 -->
<title>DSAv2 Development | Microsoft Technical Case Studies</title>
<meta property="og:title" content="Developing the next generation solutions Platform - DSAV2.x IOE">
<meta name="author" content="Ravi Kumar">
<meta property="og:locale" content="en_US">
<meta name="description" content="New Hope Liuhe, a leading Chinese agricultural company, reached out to Ye Fan Technology and Microsoft for an IoT solution that could provide automatic, real-time remote monitoring and environmental control of chicken farming facilities.">
<meta property="og:description" content="New Hope Liuhe, a leading Chinese agricultural company, reached out to Ye Fan Technology and Microsoft for an IoT solution that could provide automatic, real-time remote monitoring and environmental control of chicken farming facilities.">
<link rel="canonical" href="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html">
<meta property="og:url" content="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html">
<meta property="og:site_name" content="Microsoft Technical Case Studies">
<meta property="og:image" content="https://microsoft.github.io/techcasestudies/images/NewhopeLiuhe/feat_deployment3.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-02-17T00:00:00+00:00">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@msdev">
<meta name="twitter:creator" content="@Qixiao Wang">
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Developing the next generation solutions Platform - DSAV2.x IOE","author":{"@type":"Person","name":"Ravi Mohandas"},"image":"https://microsoft.github.io/techcasestudies/images/NewhopeLiuhe/feat_deployment3.png","datePublished":"2017-02-17T00:00:00+00:00","dateModified":"2017-02-17T00:00:00+00:00","description":"New Hope Liuhe, a leading Chinese agricultural company, reached out to Ye Fan Technology and Microsoft for an IoT solution that could provide automatic, real-time remote monitoring and environmental control of chicken farming facilities.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://microsoft.github.io/techcasestudies/images/ms-logo.png"},"name":"Qixiao Wang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html"},"url":"https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="alternate" type="application/rss+xml" title="Microsoft Technical Case Studies" href="https://microsoft.github.io/techcasestudies%20/feed.xml">
    <link rel="canonical" href="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html">

    <link rel="stylesheet" href="./Technical Debt Page_DSAv2.x_files/font-awesome.min.css">
    <link rel="stylesheet" href="./Technical Debt Page_DSAv2.x_files/main-post.css">
    
    <link rel="icon" type="image/ico" href="https://microsoft.github.io/techcasestudies/favicon.ico">

<style media="screen" type="text/css">


p {
    font-size: 14px;
}
p+p {
    font-size: 24px;
}
del {
    background: url('http://dummyimage.com/20x2/000/000') repeat-x left 0.72em;
}
p+p+p {
    font-size: 40px;
    color: red;
}
</style>

</head>


<body>

    <!-- Header -->
<div class="row content-row header">
    <div class="col-md-7 logo-container">
        <div class="logo">
            <a href="https://microsoft.github.io/techcasestudies/"><img src="./Technical Debt Page_DSAv2.x_files/acuity-logo.png" width="64" height="150"></a>
            <a id="mobileToggleSearch" class="search-hidden"><i class="fa fa-search"></i></a>
        </div>

    </div>
    <div class="col-md-5 search-container">
        <div class="search-box search-hidden">
            <form id="QuickSearch" class="form-horizontal" onsubmit="return customSearch.handleFilterChange();">
                <input type="text" class="form-control" placeholder="Search by keyword..." id="SearchPhraseText" name="SearchPhraseText">
            </form>
        </div>
    </div>
</div>

<!-- Sub-Header -->
<div class="row content-row sub-header">
    <div class="col-md-12">
        <h1>Technical Debt Tracking Page</h1>
    </div>
</div>

    <div class="page-content">
        <div class="wrapper">
            <div class="post">
    <div class="row article-hero blue">
        <div class="container">
            <div class="row">
                <div class="col s12">
                    <h4 itemprop="headline">Developing the next generation solutions Platform - DSAV2.x IOE</h4>
                    <div class="row">
                        <div class="col ss12  valign-wrapper">
                             
                            <span class="author-name">
                                <a href="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html#" itemprop="author">Ravi Mohandas</a>
                            </span>-
                            <span class="article-date">July 7, 2017</span>
                            <meta itemprop="datePublished" content="2017-07-07">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col s12 article-content">
                <article class="post-content">
                    <p>This is a team page tracking technical issues that are under consideration to add to the DSAV2.x project backlog.</p>

<p><strong>The project team:</strong></p>

<ul>
  <li>Eugene Roberov – Software Director, AcuityBrands</li>
  <li>Ilya Tserav – Product Manager, AcuityBrands</li>
  <li>Rick Zhou – IOE Architect, AcuityBrands</li>
  <li>Richards, Benton L - intern, AcuityBrands</li>
  <li>Kawamura, Akiyoshi - Sr. Software, AcuityBrands.com</li>
  <li>Ravi M – Software Engineer/Dev Lead,AcuityBrands.com</li>
</ul>


<h2 id="project-moment"><a href="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html#project-moment" class="header-link"><i class="fa fa-link"></i></a>Project Team</h2>

<p><img src="./Technical Debt Page_DSAv2.x_files/DSAV2.x-team.png" alt="DSAV2.x Team"></p>


<h2 id="the-solution"><a href="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html#the-solution" class="header-link"><i class="fa fa-link"></i></a>Technical Debt</h2>

<p>Tracks development activities including in the areas of design, coding, guidelines etc. that are unresolved or unfinished and needs team's attention. </p>
<br/>
<h5>1. Project dir Architecture</h5>
<p>The idea is to organize the code modules for a consistant view for external viewers, developers and participants in DSA OSS github  page.</p> <p>Proposed platform directory strucutre here for review with team. 
</p>
<ul>
  <li><p><img src="./Technical Debt Page_DSAv2.x_files/Platform_Dir_Structure.png" width="500" height="800" alt="OSS"></p></li>
</ul>

<h5>2. C++ Coding Guidelines</h5>
<p>The proposed coding guidelines are a guide to produce readable code that is easy to maintain and follow for other engineers. The idea is to highlight about 20 major common sense points here to consider using for DSAv2.x development.
    <p/>

Lifetime management of Objects

<ul>

<li><p>
    1. { “no naked new!” } {, "use make_shared"}
    <br/>
Using make_shared ensures that the smart pointer control block that tracks the object reference count and the weak pointer reference count is colocated 
with the object in memory which is cache optimal. Consider using an impl. pattern similar to this,

<pre><code class="language-pascal">
    shared_ptr<systembus> platform::make_systembus()
    {
	    shared_ptr<systembus> smartp = make_shared<systembus>(config);

	    return std::move(smartp);
    }
    </code></pre>
</li>

<li><br/><p>
2. { "Core reference}
    When in doubt, it is highly recommended to refer to and use the common sense guidelines by the C++ language author and guru, Stroustrup and other C++ experts <a href="https://isocpp.org/blog/2015/09/bjarne-stroustrup-announces-cpp-core-guidel">found here.</a> As a secondary source, you can refer to google C++ standard. However, know that this is supplementary 
    as the google guide is a bit out-of-date with modern C++.  </p>  
</li>

<li><p>
3. { "passing all smart_pointers by reference to functions is OK}
It is 2.5 times faster than passing by value, eventhough smart pointers are tiny beings.

<pre><code class="language-pascal">
// example....

Given structure A : 
struct A { int field; };
<br/>
Passing by reference
std::vector<std::unique_ptr<A>> container;

// the caller is giving you the opportunity to take ownership of the object
// it is free to not take it though
void maybeOwnA(std::unique_ptr<A> & ptr) {
    // ptr is passed by reference
    // so maybeOwnA can decide based on its own internal 
    // to take ownership of the pointed object

    // taking ownership requires that std::move is called on ptr

    // it may also simply use the pointed object and not
    // take ownership
}

void callMaybeOwnA() {
    std::unique_ptr<A> ptr = new A();
    maybeOwnA(ptr);
    // we know if we still own the instance of A
    // by looking at ptr
    if (ptr.get() != nullptr) {
        // we still own the pointed object
    }
}
</code></pre>

<li><p>
4. { "passing pointers to interact with legacy code}
</li>

</ul>

<h2 id="customer-profile"><a href="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html#customer-profile" class="header-link"><i class="fa fa-link"></i></a>Static analysis Quality profile</h2>
<p>
<del>The required quality profile for C++ is now a back logged task. </del></p>

<h2 id="partner-profile"><a href="https://microsoft.github.io/techcasestudies/iot/2017/02/17/NewHopeLiuhe.html#partner-profile" class="header-link"><i class="fa fa-link"></i></a>Platform error reporting</h2>

<p>
    <h5>My observations (C++ related):</h5>
     <p>+ I think DSAv2.x error machinery can be simple and expressive enough for support and debugging and should handle platform variances and give detailed clues for support personnel. The key issue to consider here are:

    <h5>Customer perspective:</h5>
    <ul><li>1.    Do we need a consistent set of error codes in DSAv2.x? </li> <li>Is there any requirement for different language SDK versions to have some similarities? </li> <li>2.    Do we care for our customers to add their own error codes using the same error machinery? </li></ul>

     </p>
<pre><code class="language-pascal">

    int ec; // ec means error code
    ec = start_events_monitor(stream_type); // your API call,


    // dsav2::error(reason) pattern offers to auto check an error code.     
    // cost is: it performs a Boolean test, ec == 0 is good, flow continues
    // if not, error can be configured to either throw or simply log and return.


    dsav2::error(reason(ec)); 


    // adds context to the error code for logging purposes.
    // translate ec that is OS, lib specific to common C++ library standard category

    reason() {
        return std::make_error_code(std::errc::connection_aborted);
    }

    </code></pre>

                </article>
            </div>
        </div>
        <div class="divider"></div>
    </div>

        </div>
    </div>

    <!--?xml version="1.0" encoding="UTF-8"?-->
<footer class="site-footer">
    <div class="wrapper">
        
        <div class="container">
        
        <div class="footer-col-wrapper slim">
            <div class="footer-col">
                <span id="FooterLinks">
                    <span id="Footer_title">DSAv2.x Development Technical Debt Page</span>
                    <span id="Footer_github">
                        <a href="https://github.com/iot-dsa-v2">DSAV2.x on GitHub</a>
                    </span>
                    <!--span id="Footer_privacyStatement">
                        <a href="http://go.microsoft.com/fwlink/?LinkId=248681">Privacy &amp; Cookies</a>
                    </span>
                    <span id="Footer_termsOfUse">
                        <a href="http://go.microsoft.com/fwlink/?LinkID=206977">Terms of Use</a>
                    </span>
                    <span id="Footer_trademarks">
                        <a href="https://www.microsoft.com/trademarks">Trademarks</a>
                    </span-->
                </span>
                <!--div id="FooterFarStack">
                    <div class="FooterMsLogoSvg">
                        <a href="http://go.microsoft.com/fwlink/p/?linkid=182163" id="FooterFarStack_MsComLogoSvg_href">
                            <svg enable-background="new 0 0 93 20" height="20px" version="1.1" viewBox="0 0 93 20" width="93px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" y="0px">
                                <g id="Type">
                                    <g>
                                        <path d="M 14.834 19 V 8.747 c 0 -0.779 0.045 -1.932 0.135 -3.459 h -0.045 c -0.15 0.809 -0.303 1.408 -0.46 1.797 L 9.59 19 H 7.849 L 2.941 7.197 C 2.814 6.8 2.661 6.164 2.481 5.288 H 2.414 C 2.436 5.49 2.46 6.018 2.486 6.871 c 0.026 0.854 0.04 1.591 0.04 2.212 V 19 H 0.044 V 2.896 h 3.818 L 7.961 13.07 c 0.389 0.98 0.632 1.723 0.73 2.224 h 0.067 l 0.854 -2.246 l 4.211 -10.152 h 3.661 V 19 H 14.834 Z" fill="#ffffff"></path>
                                        <path d="M 23.281 3.435 c 0 0.427 -0.155 0.782 -0.466 1.067 c -0.311 0.285 -0.687 0.427 -1.128 0.427 c -0.442 0 -0.816 -0.142 -1.123 -0.427 c -0.307 -0.285 -0.46 -0.64 -0.46 -1.067 c 0 -0.434 0.155 -0.797 0.466 -1.089 c 0.311 -0.292 0.683 -0.438 1.118 -0.438 c 0.457 0 0.836 0.15 1.14 0.449 S 23.281 3.015 23.281 3.435 Z M 20.361 19 V 7.5 h 2.594 V 19 H 20.361 Z" fill="#ffffff"></path>
                                        <path d="M 33.91 18.518 c -0.883 0.509 -1.973 0.764 -3.268 0.764 c -1.107 0 -2.094 -0.24 -2.959 -0.719 c -0.865 -0.479 -1.539 -1.161 -2.021 -2.045 c -0.483 -0.883 -0.724 -1.871 -0.724 -2.965 c 0 -1.25 0.249 -2.354 0.747 -3.313 c 0.498 -0.958 1.221 -1.701 2.167 -2.229 c 0.947 -0.527 2.046 -0.792 3.296 -0.792 c 0.486 0 0.992 0.054 1.516 0.163 c 0.523 0.109 0.939 0.249 1.246 0.421 v 2.459 c -0.846 -0.614 -1.729 -0.921 -2.65 -0.921 c -1.078 0 -1.951 0.361 -2.622 1.084 c -0.67 0.723 -1.005 1.686 -1.005 2.892 c 0 1.198 0.322 2.138 0.966 2.819 c 0.644 0.681 1.516 1.021 2.616 1.021 c 0.398 0 0.844 -0.086 1.338 -0.258 c 0.494 -0.173 0.947 -0.408 1.357 -0.708 V 18.518 Z" fill="#ffffff"></path>
                                        <path d="M 42.771 10.027 c -0.135 -0.097 -0.355 -0.187 -0.663 -0.27 c -0.307 -0.083 -0.588 -0.124 -0.842 -0.124 c -0.757 0 -1.366 0.322 -1.831 0.966 c -0.464 0.645 -0.696 1.482 -0.696 2.516 V 19 h -2.594 V 7.5 h 2.594 v 2.235 h 0.045 c 0.255 -0.771 0.641 -1.37 1.157 -1.797 s 1.111 -0.64 1.785 -0.64 c 0.449 0 0.798 0.052 1.045 0.157 V 10.027 Z" fill="#ffffff"></path>
                                        <path d="M 55.17 13.138 c 0 1.864 -0.539 3.354 -1.617 4.47 s -2.542 1.674 -4.391 1.674 c -1.774 0 -3.188 -0.53 -4.239 -1.59 s -1.578 -2.495 -1.578 -4.307 c 0 -1.909 0.539 -3.414 1.617 -4.515 s 2.571 -1.651 4.48 -1.651 c 1.797 0 3.201 0.526 4.212 1.578 C 54.665 9.849 55.17 11.296 55.17 13.138 Z M 52.475 13.228 c 0 -1.272 -0.282 -2.239 -0.848 -2.897 s -1.342 -0.988 -2.33 -0.988 c -1.019 0 -1.815 0.344 -2.393 1.033 c -0.576 0.689 -0.864 1.662 -0.864 2.92 c 0 1.221 0.288 2.169 0.864 2.847 c 0.577 0.678 1.382 1.017 2.415 1.017 c 1.04 0 1.826 -0.333 2.358 -1 C 52.209 15.492 52.475 14.516 52.475 13.228 Z" fill="#ffffff"></path>
                                        <path d="M 64.486 15.709 c 0 1.071 -0.412 1.934 -1.235 2.589 c -0.824 0.655 -1.939 0.983 -3.347 0.983 c -0.457 0 -0.976 -0.061 -1.556 -0.18 c -0.58 -0.12 -1.064 -0.27 -1.454 -0.449 V 16.17 c 0.479 0.345 1.003 0.61 1.572 0.797 c 0.569 0.188 1.082 0.281 1.538 0.281 c 1.243 0 1.864 -0.412 1.864 -1.235 c 0 -0.292 -0.062 -0.526 -0.185 -0.702 c -0.124 -0.176 -0.337 -0.352 -0.641 -0.527 c -0.303 -0.176 -0.772 -0.395 -1.409 -0.657 c -0.749 -0.321 -1.305 -0.633 -1.668 -0.933 c -0.363 -0.299 -0.633 -0.65 -0.809 -1.055 s -0.264 -0.877 -0.264 -1.416 c 0 -1.033 0.408 -1.875 1.224 -2.527 c 0.816 -0.651 1.872 -0.977 3.167 -0.977 c 0.397 0 0.849 0.047 1.354 0.14 c 0.506 0.094 0.915 0.208 1.229 0.343 v 2.347 c -0.352 -0.24 -0.768 -0.432 -1.246 -0.579 c -0.479 -0.146 -0.955 -0.219 -1.427 -0.219 c -0.517 0 -0.924 0.116 -1.224 0.348 s -0.449 0.528 -0.449 0.887 c 0 0.404 0.118 0.721 0.354 0.949 c 0.236 0.228 0.792 0.519 1.668 0.87 c 1.078 0.434 1.838 0.917 2.279 1.449 C 64.266 14.287 64.486 14.938 64.486 15.709 Z" fill="#ffffff"></path>
                                        <path d="M 77.858 13.138 c 0 1.864 -0.539 3.354 -1.617 4.47 s -2.542 1.674 -4.391 1.674 c -1.774 0 -3.188 -0.53 -4.239 -1.59 s -1.578 -2.495 -1.578 -4.307 c 0 -1.909 0.539 -3.414 1.617 -4.515 s 2.571 -1.651 4.48 -1.651 c 1.797 0 3.201 0.526 4.212 1.578 C 77.354 9.849 77.858 11.296 77.858 13.138 Z M 75.163 13.228 c 0 -1.272 -0.282 -2.239 -0.848 -2.897 s -1.342 -0.988 -2.33 -0.988 c -1.019 0 -1.815 0.344 -2.393 1.033 c -0.576 0.689 -0.864 1.662 -0.864 2.92 c 0 1.221 0.288 2.169 0.864 2.847 c 0.577 0.678 1.382 1.017 2.415 1.017 c 1.04 0 1.826 -0.333 2.358 -1 C 74.897 15.492 75.163 14.516 75.163 13.228 Z" fill="#ffffff"></path>
                                        <path d="M 85.838 4.097 c -0.419 -0.187 -0.831 -0.281 -1.235 -0.281 c -0.568 0 -1.011 0.182 -1.325 0.545 c -0.314 0.363 -0.472 0.896 -0.472 1.6 V 7.5 h 2.572 v 2.089 h -2.572 V 19 h -2.628 V 9.589 h -1.932 V 7.5 h 1.932 V 5.815 c 0 -0.801 0.175 -1.514 0.522 -2.14 c 0.349 -0.625 0.839 -1.11 1.472 -1.454 c 0.632 -0.344 1.349 -0.517 2.15 -0.517 c 0.636 0 1.142 0.067 1.516 0.202 V 4.097 Z" fill="#ffffff"></path>
                                        <path d="M 92.395 18.888 c -0.157 0.09 -0.437 0.178 -0.837 0.264 s -0.788 0.13 -1.162 0.13 c -2.254 0 -3.381 -1.213 -3.381 -3.639 V 9.589 h -1.909 V 7.5 h 1.909 V 4.85 l 2.605 -0.797 V 7.5 h 2.774 v 2.089 H 89.62 v 5.57 c 0 0.727 0.131 1.241 0.394 1.544 c 0.262 0.304 0.674 0.455 1.235 0.455 c 0.149 0 0.339 -0.032 0.567 -0.096 c 0.228 -0.063 0.421 -0.147 0.578 -0.252 V 18.888 Z" fill="#ffffff"></path>
                                    </g>
                                </g>
                            </svg>
                        </a>
                    </div-->
                    <div>
                        <div id="FooterCopyright">© 2017 Acuity Brands</div>
                    </div>
                </div>
            </div>
        </div>
        
        </div>
        
    </div>
</footer>

    <script src="./Technical Debt Page_DSAv2.x_files/wedcs.js.download"></script>
    <script src="./Technical Debt Page_DSAv2.x_files/ms.js.download"></script><iframe id="_msnFrame" src="./Technical Debt Page_DSAv2.x_files/c.html" style="z-index:-1;height:1px;width:1px;display:none;visibility:hidden;"></iframe>
    <script src="./Technical Debt Page_DSAv2.x_files/jquery-3.2.1.min.js.download"></script>
    <script>
        window.jQuery || document.write('<script src="javascrtips/jquery-3.2.1.min.js"><\/script>')
    </script>
    <script src="./Technical Debt Page_DSAv2.x_files/materialize.min.js.download"></script>
    <script src="./Technical Debt Page_DSAv2.x_files/packery.pkgd.min.js.download"></script>
    <script src="./Technical Debt Page_DSAv2.x_files/main.js.download"></script>
    <script src="./Technical Debt Page_DSAv2.x_files/interactions.js.download"></script>
    <script src="./Technical Debt Page_DSAv2.x_files/anchorizeHeaders.js.download"></script>


</div><div class="hiddendiv common"></div></body></html>